import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,b as e,o as n}from"./app-KY5IitRR.js";const l="/assets/image/idea/profiles.png",t="/assets/image/nacos/namespaces-tab.png",p="/assets/image/nacos/namespaces-create.png",d={};function h(r,i){return n(),a("div",null,i[0]||(i[0]=[e(`<h2 id="什么是多环境配置" tabindex="-1"><a class="header-anchor" href="#什么是多环境配置"><span>什么是多环境配置？</span></a></h2><p>在实际项目开发过程中，我们往往需要区分开发，测试，联调,预发布，生产等不同的应用环境。这些应用环境用途不同，对应环境的配置项,稳定性,数据质量,保障性,可接触人群等要求也不同，比如 Swagger 一般上在生产时是关闭的；不同环境数据库地址,端口号等都是不尽相同的。要是没有多环境的自由切换，部署起来是很繁琐也容易出错的。</p><p>使用多环境配置，可以针对不同的应用环境，提前配置好对应的环境配置信息。在使用时，仅需要修改具体的环境名称，就可以把对应环境配置信息,系统参数等相关内容全部切换。不仅使用便捷，还极大地降低了手工修改参数的出错率。</p><h2 id="maven-多环境配置" tabindex="-1"><a class="header-anchor" href="#maven-多环境配置"><span>Maven 多环境配置</span></a></h2><p>使用<code>Maven</code>可以通过在<code>pom.xml</code>中增加<code>&lt;profiles&gt;</code>配置进行多环境的配置。参见以下示例：</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profiles</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;development&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">activation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">activeByDefault</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;true&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">activeByDefault</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">activation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">properties</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">properties</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;produtction&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">properties</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">properties</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;testing&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">properties</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">            ...</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">properties</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profiles</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过下面配置就可以指定当前默认的环境是哪个</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">activation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">activeByDefault</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;true&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">activeByDefault</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">activation</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在开发和使用过程中，必须要配置一个默认的环境。配置完成之后，在 IDE 中也会提供可操作性界面进行操作。下图即为 IDEA 的界面示例：</p><figure><img src="`+l+`" alt="profiles" tabindex="0" loading="lazy"><figcaption>profiles</figcaption></figure><h2 id="spring-boot-多环境配置" tabindex="-1"><a class="header-anchor" href="#spring-boot-多环境配置"><span>Spring Boot 多环境配置</span></a></h2><h3 id="spring-boot-环境设置机制" tabindex="-1"><a class="header-anchor" href="#spring-boot-环境设置机制"><span>Spring Boot 环境设置机制</span></a></h3><p><code>spring.profiles.active</code> 属性可以为我们指定当前设置的环境，以此来选择我们的配置文件。例如我们有配置文件</p><ul><li>application.yml</li><li>application-dev.yml</li><li>application-test.yml</li><li>application-prod.yml</li></ul><p>当执行 <code>java -jar xxx.jar --spring.profiles.actvie=test</code> 此时，系统将启用 <code>application.yml</code> 和 <code>application-test.yml</code> 配置文件。</p><p>当执行 <code>java -jar xxx.jar --spring.profiles.actvie=prod</code> 此时，系统将启用 <code>application.yml</code> 和 <code>application-prod.yml</code> 配置文件。</p><p>正是这种配置参数可以决定我们使用哪种配置文件，如果我们把不同环境的配置写在对应的配置文件中，我们就可以实现多环境机制。</p><h3 id="配置多环境" tabindex="-1"><a class="header-anchor" href="#配置多环境"><span>配置多环境</span></a></h3><p>正如上一点所述，我们配置不同的配置文件</p><ul><li>application.yml</li><li>application-dev.yml（开发环境）</li><li>application-test.yml（测试环境）</li><li>application-uat.yml（预发布环境）</li><li>application-prod.yml（生产环境）</li></ul><h3 id="指定环境" tabindex="-1"><a class="header-anchor" href="#指定环境"><span>指定环境</span></a></h3><ul><li>在 cmd 命令中指定</li></ul><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">java</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -jar</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> xxx.jar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --spring.profiles.actvie=dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>在 <code>application.yml</code> 中指定</li></ul><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  profiles</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    active</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">dev</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>在 IDEA 编辑器中指定</li></ul><p>在运行按钮（绿色三角形按钮）旁边选择 <code>Edit Configurations...</code>，在弹出的对话框中 <code>Active profiles</code> 输入 <code>dev</code> 或其他即可。</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>这种方法只有在本地调试的时候才生效。</p></div><h3 id="单一文件写法" tabindex="-1"><a class="header-anchor" href="#单一文件写法"><span>单一文件写法</span></a></h3><div class="language-yml line-numbers-mode" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:  @</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">artifactId@</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  profiles</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    active</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">develpment</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">---</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 开发环境配置</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    activate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      on-profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">develpment</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">---</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 生产环境配置</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">  config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">    activate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">      on-profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">production</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nacos-多环境配置" tabindex="-1"><a class="header-anchor" href="#nacos-多环境配置"><span>Nacos 多环境配置</span></a></h2><p>本身没有提供统一的多环境管理。在 Nacos 中，本身有多个不同管理级别的概念，包括：Data ID,Group,Namespace。只要利用好这些层级概念的关系，就可以根据自己的需要来实现多环境的管理。</p><h3 id="data-id" tabindex="-1"><a class="header-anchor" href="#data-id"><span>Data Id</span></a></h3><ol><li><code>Data Id</code>的默认值为<code>\${spring.cloud.nacos.config.prefix}-\${spring.profile.active}.\${spring.cloud.nacos.config.file-extension}</code></li><li><code>spring.cloud.nacos.config.prefix</code>的默认值为<code>\${spring.application.name}</code></li><li><code>spring.cloud.nacos.config.file-extension</code>的默认值为<code>properties</code></li><li>当<code>spring.profiles.active</code>未配置时，则匹配<code>\${spring.application.name}.properties</code></li><li>若设置了<code>spring.profiles.active</code>而<code>Nacos</code>中存在<code>\${spring.application.name}.properties</code>时，若还存在</li><li><code>\${spring.application.name}-\${spring.profiles.active}.properties</code>，则默认匹配后者，若不存在，则会自动匹配前者<br> 由于<code>Nacos</code>建议且默认用<code>spring.application.name</code>作为<code>Data Id</code>的前缀，若要在不同服务中共享项目统一配置，则可以通过配置<code>spring.cloud.nacos.config.shared-dataids</code>或<code>spring.cloud.nacos.config.refreshable-dataids</code>来添加共享配置，前者不支持自动刷新，后者支持</li></ol><h3 id="group" tabindex="-1"><a class="header-anchor" href="#group"><span>Group</span></a></h3><p><code>Group</code>是一个很灵活的配置项，并没有固定的规定，可以用作多环境,多模块,多版本之间区分配置</p><h3 id="namespace" tabindex="-1"><a class="header-anchor" href="#namespace"><span>Namespace</span></a></h3><p>使用命名空间来区分不同环境的配置，因为使用<code>profiles</code>或<code>group</code>会是不同环境的配置展示到一个页面，而<code>Nacos</code>控制台对不同的<code>Namespace</code>做了<code>Tab</code>栏分组展示</p><figure><img src="`+t+'" alt="Namespaces Tab" tabindex="0" loading="lazy"><figcaption>Namespaces Tab</figcaption></figure><p>创建方式如下图所示</p><figure><img src="'+p+`" alt="Namespaces Create" tabindex="0" loading="lazy"><figcaption>Namespaces Create</figcaption></figure><div class="hint-container caution"><p class="hint-container-title">警告</p><p>配置 Namespace 的时候不是通过名称，而是通过命名空间的 ID(上图所示)，可通过如下配置来设置服务使用的命名空间</p></div><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;docker&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">properties</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!--当前环境--&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profile.name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;docker&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profile.name</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!--数据库类型--&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">database.type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;postgresql&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">database.type</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!--代码构建控制--&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!--跳过构建源代码包--&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">skip.build.source.package</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;false&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">skip.build.source.package</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!--不copy代码包到docker构建目录--&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">skip.copy.docker.resource</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;false&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">skip.copy.docker.resource</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!--不执行git commit 构建--&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">skip.build.git.commit.info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;false&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">skip.build.git.commit.info</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!--Nacos配置中心地址--&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">config.server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;192.168.101.10:8848&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">config.server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!--Nacos配置中心命名空间,用于支持多环境.这里必须使用ID，不能使用名称,默认为空--&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">config.namespace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">config.namespace</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">        &lt;!--Nacos服务发现地址--&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">discovery.server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;192.168.101.10:8848&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">discovery.server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sentinel.server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;192.168.101.10:8858&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">sentinel.server-addr</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">properties</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">profile</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="docker-和-k8s-多环境配置" tabindex="-1"><a class="header-anchor" href="#docker-和-k8s-多环境配置"><span>Docker 和 K8S 多环境配置</span></a></h2><p><code>Docker</code>和<code>K8S</code>的多环境，因为不同使用者使用的方式不同，<strong>Dante Cloud</strong> 并没有过多涉及。<strong>Dante Cloud</strong> 中，也简单定义了自己<code>Docker</code>多环境，涉及<code>production</code>和<code>development</code>两个环境，主要区别是<code>production</code>环境 docker 打包会包含<code>Skywalking Agent</code>，而<code>development</code>环境 docker 打包只会包含应用，通过执行不同的<code>docker-compose</code>文件进行区分仅此而已。如果不使用<code>Skywalking</code>，使用<code>development</code>环境打包 docker 即可。</p><h2 id="dante-cloud-的多环境配置" tabindex="-1"><a class="header-anchor" href="#dante-cloud-的多环境配置"><span>Dante Cloud 的多环境配置</span></a></h2><p>微服务架构涉及多方面内容，<strong>Dante Cloud</strong>的为解决多环境，综合使用<code>Maven</code>,<code>Spring Boot</code>以及<code>Nacos</code>多环境的特点，以支持微服务的多环境切换和多种数据库的配置支持。</p><h3 id="dante-cloud-中的-maven-多环境配置" tabindex="-1"><a class="header-anchor" href="#dante-cloud-中的-maven-多环境配置"><span>Dante Cloud 中的 Maven 多环境配置</span></a></h3><p><strong>Dante Cloud</strong> Maven 多环境配置，在工程根目录下的<code>pom.xml</code>中进行配置。这里的环境配置主要解决以下问题：</p><ol><li><strong>传递参数</strong>：传递<code>&lt;profile.name&gt;</code>和<code>&lt;database.type&gt;</code>两个参数。</li></ol><ul><li><code>&lt;profile.name&gt;</code>的值传递至<code>bootstrap.yml</code>中，这样就可以联动使用<code>Spring Boot</code>和<code>Nacos</code>的多环境配置；</li><li><code>&lt;database.type&gt;</code>参数，传递至<code>bootstrap.yml</code>中，用于指定具体使用的数据库配置</li></ul><ol start="2"><li><strong>Dashboard</strong>：通过<code>&lt;skip.build.source.package&gt;</code>,<code>&lt;skip.copy.docker.resource&gt;</code>和<code>&lt;skip.build.git.commit.info&gt;</code>三个参数进行打包控制。</li></ol><ul><li><code>&lt;skip.build.source.package&gt;</code> 控制是否构建源代码包：构建源代码包便于调试<code>dante-cloud-athena</code>的调试。</li><li><code>&lt;skip.copy.docker.resource&gt;</code> 控制是否拷贝服务 jar 包：编译完成后，将可执行额外操作，将服务 jar 包拷贝到统一的 docker build context 下，使用统一配置 build docker，这样就不必每一个服务都编写<code>Dockerfile</code></li><li><code>&lt;skip.build.git.commit.info&gt;</code> 控制是否生成 Git 信息：是否将 Git commit 等相关信息在编译打包时，写入到 jar 包中。写入 Git commit 等相关信息，可以便于在运维过程中快速区分不同 jar 对应的提交信息,编译,开发者等相关信息。</li></ul><ol start="3"><li><strong><code>Nacos</code> 和 <code>Sentinel Dashboard</code>地址指定</strong>：</li></ol><p>指定不同环境下<code>Nacos</code>配置中心,服务发现和<code>Sentinel Dashboard</code>的地址，<code>Nacos</code>配置中心,服务发现地址无法写在<code>Nacos</code>的配置中，所以在此处进行设置。</p><h3 id="dante-cloud-中的-spring-boot-和-nacos-多环境配置" tabindex="-1"><a class="header-anchor" href="#dante-cloud-中的-spring-boot-和-nacos-多环境配置"><span>Dante Cloud 中的 Spring Boot 和 Nacos 多环境配置</span></a></h3><ul><li>通过<code>Spring Boot</code>的<code>profiles</code>机制，实现<code>Spring Boot</code>与<code>Nacos</code>的联动。</li><li>利用<code>Nacos</code>的<code>Group</code>信息，实现<code>Nacos</code>配置的多环境。<code>\${project_home}/platform/dante-cloud-monitor/resources/configs</code>目录下，还有一级目录。这级目录的名称，是对应<code>Nacos</code>中的<code>Group</code>。所以在向<code>Nacos</code>导入配置时，一定要注意<code>Group</code>的创建和匹配。切勿全部导入到<code>DEFAULT</code>组下，这样会导致无法正常运行。</li></ul>`,57)]))}const c=s(d,[["render",h],["__file","profile-design.html.vue"]]),g=JSON.parse('{"path":"/guide/backend/profile-design.html","title":"多环境配置","lang":"zh-CN","frontmatter":{"icon":"caret-right","title":"多环境配置","tag":["SAS","Spring Authorization Server","Dante Cloud","微服务","领域驱动","DDD","Spring Boot","Spring Cloud","Spring Security","Spring Cloud Alibaba","Spring Cloud Tencent","OAuth2.1","Nacos","Skywalking","Sentinel","Seata"],"description":"什么是多环境配置？ 在实际项目开发过程中，我们往往需要区分开发，测试，联调,预发布，生产等不同的应用环境。这些应用环境用途不同，对应环境的配置项,稳定性,数据质量,保障性,可接触人群等要求也不同，比如 Swagger 一般上在生产时是关闭的；不同环境数据库地址,端口号等都是不尽相同的。要是没有多环境的自由切换，部署起来是很繁琐也容易出错的。 使用多环境...","head":[["meta",{"property":"og:url","content":"https://dante-cloud.dromara.org/guide/backend/profile-design.html"}],["meta",{"property":"og:site_name","content":"“一套代码、两种架构”的企业级应用系统"}],["meta",{"property":"og:title","content":"多环境配置"}],["meta",{"property":"og:description","content":"什么是多环境配置？ 在实际项目开发过程中，我们往往需要区分开发，测试，联调,预发布，生产等不同的应用环境。这些应用环境用途不同，对应环境的配置项,稳定性,数据质量,保障性,可接触人群等要求也不同，比如 Swagger 一般上在生产时是关闭的；不同环境数据库地址,端口号等都是不尽相同的。要是没有多环境的自由切换，部署起来是很繁琐也容易出错的。 使用多环境..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://dante-cloud.dromara.org/assets/image/idea/profiles.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-12-31T08:05:14.000Z"}],["meta",{"property":"article:tag","content":"SAS"}],["meta",{"property":"article:tag","content":"Spring Authorization Server"}],["meta",{"property":"article:tag","content":"Dante Cloud"}],["meta",{"property":"article:tag","content":"微服务"}],["meta",{"property":"article:tag","content":"领域驱动"}],["meta",{"property":"article:tag","content":"DDD"}],["meta",{"property":"article:tag","content":"Spring Boot"}],["meta",{"property":"article:tag","content":"Spring Cloud"}],["meta",{"property":"article:tag","content":"Spring Security"}],["meta",{"property":"article:tag","content":"Spring Cloud Alibaba"}],["meta",{"property":"article:tag","content":"Spring Cloud Tencent"}],["meta",{"property":"article:tag","content":"OAuth2.1"}],["meta",{"property":"article:tag","content":"Nacos"}],["meta",{"property":"article:tag","content":"Skywalking"}],["meta",{"property":"article:tag","content":"Sentinel"}],["meta",{"property":"article:tag","content":"Seata"}],["meta",{"property":"article:modified_time","content":"2024-12-31T08:05:14.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"多环境配置\\",\\"image\\":[\\"https://dante-cloud.dromara.org/assets/image/idea/profiles.png\\",\\"https://dante-cloud.dromara.org/assets/image/nacos/namespaces-tab.png\\",\\"https://dante-cloud.dromara.org/assets/image/nacos/namespaces-create.png\\"],\\"dateModified\\":\\"2024-12-31T08:05:14.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"码匠君\\",\\"url\\":\\"https://www.herodotus.cn\\"}]}"],["meta",{"name":"keywords","content":"SAS,Spring Authorization Server,Dante Cloud,微服务,DDD,Spring Boot,Spring Cloud,Spring Cloud Alibaba,Spring Cloud Tencent,Nacos,WebFlux,RSocket,GPRC,Minio"}],["script",{},"var _hmt = _hmt || [];\\n            (function() {\\n              var hm = document.createElement(\\"script\\");\\n              hm.src = \\"https://hm.baidu.com/hm.js?9d06530da5dbac9ce977a65ddf8e1cc0\\";\\n              var s = document.getElementsByTagName(\\"script\\")[0]; \\n              s.parentNode.insertBefore(hm, s);\\n            })();"]]},"headers":[{"level":2,"title":"什么是多环境配置？","slug":"什么是多环境配置","link":"#什么是多环境配置","children":[]},{"level":2,"title":"Maven 多环境配置","slug":"maven-多环境配置","link":"#maven-多环境配置","children":[]},{"level":2,"title":"Spring Boot 多环境配置","slug":"spring-boot-多环境配置","link":"#spring-boot-多环境配置","children":[{"level":3,"title":"Spring Boot 环境设置机制","slug":"spring-boot-环境设置机制","link":"#spring-boot-环境设置机制","children":[]},{"level":3,"title":"配置多环境","slug":"配置多环境","link":"#配置多环境","children":[]},{"level":3,"title":"指定环境","slug":"指定环境","link":"#指定环境","children":[]},{"level":3,"title":"单一文件写法","slug":"单一文件写法","link":"#单一文件写法","children":[]}]},{"level":2,"title":"Nacos 多环境配置","slug":"nacos-多环境配置","link":"#nacos-多环境配置","children":[{"level":3,"title":"Data Id","slug":"data-id","link":"#data-id","children":[]},{"level":3,"title":"Group","slug":"group","link":"#group","children":[]},{"level":3,"title":"Namespace","slug":"namespace","link":"#namespace","children":[]}]},{"level":2,"title":"Docker 和 K8S 多环境配置","slug":"docker-和-k8s-多环境配置","link":"#docker-和-k8s-多环境配置","children":[]},{"level":2,"title":"Dante Cloud 的多环境配置","slug":"dante-cloud-的多环境配置","link":"#dante-cloud-的多环境配置","children":[{"level":3,"title":"Dante Cloud 中的 Maven 多环境配置","slug":"dante-cloud-中的-maven-多环境配置","link":"#dante-cloud-中的-maven-多环境配置","children":[]},{"level":3,"title":"Dante Cloud 中的 Spring Boot 和 Nacos 多环境配置","slug":"dante-cloud-中的-spring-boot-和-nacos-多环境配置","link":"#dante-cloud-中的-spring-boot-和-nacos-多环境配置","children":[]}]}],"git":{"createdTime":1735632314000,"updatedTime":1735632314000,"contributors":[{"name":"码匠君","username":"码匠君","email":"pointer_v@qq.com","commits":1,"url":"https://github.com/码匠君"}]},"readingTime":{"minutes":6.5,"words":1949},"filePathRelative":"guide/backend/profile-design.md","localizedDate":"2024年12月31日","autoDesc":true}');export{c as comp,g as data};
